{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="flashcard-form">
        <h2>Create New Flashcard</h2>
        <form id="flashcardForm" onsubmit="createFlashcard(event)">
            <div class="form-group">
                <label for="question">Question:</label>
                <textarea id="question" required rows="3" placeholder="Enter your question"></textarea>
            </div>
            <div class="form-group">
                <label for="answer">Answer:</label>
                <textarea id="answer" required rows="3" placeholder="Enter your answer"></textarea>
            </div>
            <button type="submit" class="create-btn">Create Flashcard</button>
        </form>
    </div>
    
    <div id="flashcardsContainer" class="flashcards-container"></div>
</div>

<style>
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.flashcard-form {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
}

.form-group textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    resize: vertical;
    font-size: 14px;
}

.create-btn {
    background-color: var(--theme-color, #FFB6C1);
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 16px;
    transition: opacity 0.3s;
}

.create-btn:hover {
    opacity: 0.9;
}

.flashcards-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    padding: 20px 0;
}

.flashcard {
    width: 300px;
    height: 200px;
    perspective: 1000px;
    margin: 0 auto;
}

.flashcard-inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: center;
    transition: transform 0.8s;
    transform-style: preserve-3d;
    cursor: pointer;
}

.flashcard.flipped .flashcard-inner {
    transform: rotateY(180deg);
}

.flashcard-front, .flashcard-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    background: white;
    font-size: 16px;
    line-height: 1.5;
}

.flashcard-back {
    transform: rotateY(180deg);
    background: #f8f8f8;
}

.delete-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #ff4444;
    z-index: 2;
}

.delete-btn:hover {
    color: #cc0000;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadFlashcards();
});

function createFlashcard(event) {
    event.preventDefault();
    
    const question = document.getElementById('question').value;
    const answer = document.getElementById('answer').value;
    
    if (!question || !answer) {
        alert('Please fill in both question and answer fields');
        return;
    }
    
    fetch('/create_flashcard', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 
            front: question,
            back: answer 
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            document.getElementById('flashcardForm').reset();
            loadFlashcards();
        } else {
            alert('Error creating flashcard: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error creating flashcard');
    });
}

function loadFlashcards() {
    fetch('/get_flashcards')
    .then(response => response.json())
    .then(flashcards => {
        const container = document.getElementById('flashcardsContainer');
        container.innerHTML = '';
        
        flashcards.forEach((card, index) => {
            const div = document.createElement('div');
            div.className = 'flashcard';
            div.innerHTML = `
                <div class="flashcard-inner">
                    <button class="delete-btn" onclick="event.stopPropagation(); deleteFlashcard(${index})">Ã—</button>
                    <div class="flashcard-front">
                        <p>${card.front}</p>
                    </div>
                    <div class="flashcard-back">
                        <p>${card.back}</p>
                    </div>
                </div>
            `;
            div.addEventListener('dblclick', () => {
                div.classList.toggle('flipped');
            });
            container.appendChild(div);
        });
    })
    .catch(error => console.error('Error:', error));
}

function deleteFlashcard(index) {
    fetch('/delete_flashcard', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ index })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            loadFlashcards();
        } else {
            alert('Error deleting flashcard: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error deleting flashcard');
    });
}
</script>
{% endblock %}
