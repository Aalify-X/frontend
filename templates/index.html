{% extends "base.html" %}

{% block title %}Progrify: Productivity Companion{% endblock %}

{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <div id="divLoginError" style="display: none;">
        <div id="lblLoginErrorMessage" class="errorlabel"></div>
    </div>

    <div class="container">
        <div class="login-box">
            {% if not show_otp_form %}
            <!-- Login form -->
            <h2>Progrify Login</h2>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert {{ 'success' if category == 'success' else 'error' }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <form method="POST" action="{{ url_for('login') }}">
                <div class="input-group">
                    <input type="email" name="email" required placeholder="Enter your email">
                </div>
                <button type="submit" class="btn">Send OTP</button>
            </form>
            {% else %}
            <!-- OTP Verification form -->
            <h2>Verify OTP</h2>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert {{ 'success' if category == 'success' else 'error' }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <form method="POST" action="{{ url_for('verify_otp') }}">
                <div class="input-group">
                    <input type="text" name="otp" required placeholder="Enter 6-digit OTP">
                </div>
                <button type="submit" class="btn">Verify OTP</button>
            </form>
            <p><a href="{{ url_for('login') }}">Request new OTP</a></p>
            {% endif %}
        </div>
    </div>

    {% if session.get('logged_in') %}
    <div id="app">
        <div class="header">
            <h1>Progrify Dashboard</h1>
            <div id="lblAuthState" class="authlabel"></div>
        </div>
        <div class="content">
            <div class="features">
                <div class="feature">
                    <h3>Document Intelligence</h3>
                    <p>Transform PDFs into actionable insights</p>
                </div>
                <div class="feature">
                    <h3>Smart Flash Cards</h3>
                    <p>Create and organize your learning</p>
                </div>
                <div class="feature">
                    <h3>Digital Planner</h3>
                    <p>Organize your daily schedule</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Firebase scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
<script src="{{ url_for('static', filename='index.js') }}"></script>

<script>
    // Initialize Firebase if needed
    document.addEventListener('DOMContentLoaded', function() {
        // Your existing Firebase initialization code if any
    });
</script>
{% endblock %}
